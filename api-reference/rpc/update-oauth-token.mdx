---
title: 'Atualizar Token OAuth'
api: 'POST /rest/v1/rpc/update_oauth_token'
description: 'Atualiza access_token apos refresh'
---

## Objetivo

Atualizar o `access_token` apos fazer refresh na API do Google. Chamado automaticamente pelo workflow de agendamento.

## Endpoint

```
POST {SUPABASE_URL}/rest/v1/rpc/update_oauth_token
```

## Headers

```bash
apikey: SUA_ANON_KEY
Authorization: Bearer SUA_SERVICE_KEY
Content-Type: application/json
```

## Request Body

<ParamField body="p_email" type="string" required>
  Email da conta Google
</ParamField>

<ParamField body="p_access_token" type="string" required>
  Novo access_token obtido do refresh
</ParamField>

<ParamField body="p_expires_in" type="integer" required>
  Tempo de expiracao em segundos (geralmente 3600)
</ParamField>

```json
{
  "p_email": "usuario@gmail.com",
  "p_access_token": "ya29.a0AfH6SMBx_NOVO_TOKEN...",
  "p_expires_in": 3600
}
```

## Response

```json
{
  "success": true
}
```

## Exemplo cURL

```bash
curl -X POST '{SUPABASE_URL}/rest/v1/rpc/update_oauth_token' \
  -H 'apikey: SUA_ANON_KEY' \
  -H 'Authorization: Bearer SUA_SERVICE_KEY' \
  -H 'Content-Type: application/json' \
  -d '{
    "p_email": "usuario@gmail.com",
    "p_access_token": "ya29.novo_token...",
    "p_expires_in": 3600
  }'
```

## Exemplo N8N - Workflow Completo

```json
{
  "name": "AtualizarToken",
  "method": "POST",
  "url": "{SUPABASE_URL}/rest/v1/rpc/update_oauth_token",
  "body": {
    "p_email": "={{ $('ConsultarToken').item.json.email }}",
    "p_access_token": "={{ $json.access_token }}",
    "p_expires_in": "={{ $json.expires_in }}"
  }
}
```

## Fluxo de Refresh

```
1. get_oauth_token → obter refresh_token
2. POST https://oauth2.googleapis.com/token
   - grant_type: refresh_token
   - refresh_token: {token}
   - client_id: {seu_client_id}
   - client_secret: {seu_client_secret}
3. update_oauth_token → salvar novo access_token
```

<Note>
  O `refresh_token` NAO muda no refresh. Apenas o `access_token` e atualizado.
</Note>
