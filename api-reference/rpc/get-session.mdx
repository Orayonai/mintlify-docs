---
title: 'Buscar Sessao'
openapi: 'POST /rest/v1/rpc/get_session_context_by_phone'
description: 'Retorna contexto da sessao ativa por telefone'
---

## Objetivo

Obter o contexto da sessao ativa de um contato pelo telefone.

## Endpoint

```
POST {SUPABASE_URL}/rest/v1/rpc/get_session_context_by_phone
```

## Headers

```bash
apikey: SUA_ANON_KEY
Authorization: Bearer SUA_SERVICE_KEY
Content-Type: application/json
```

## Request Body

<ParamField body="p_phone" type="string" required>
  Telefone do contato
</ParamField>

<ParamField body="p_owner_phone" type="string" required>
  Telefone do WhatsApp Business
</ParamField>

```json
{
  "p_phone": "5511999999999",
  "p_owner_phone": "5511888888888"
}
```

## Response

```json
{
  "session_id": "123e4567-e89b-12d3-a456-426614174000",
  "status": "OPEN",
  "contact_id": "550e8400-e29b-41d4-a716-446655440000",
  "last_message": "Ola, preciso de ajuda",
  "last_message_at": "2026-01-15T18:30:00Z",
  "created": false
}
```

## Campos da Response

| Campo | Tipo | Descricao |
|-------|------|-----------|
| `session_id` | uuid | ID da sessao |
| `status` | string | OPEN, PAUSED, CLOSED |
| `contact_id` | uuid | ID do contato |
| `last_message` | string | Texto da ultima mensagem |
| `last_message_at` | timestamp | Data da ultima mensagem |
| `created` | boolean | `true` se foi criada nova |

## Exemplo cURL

```bash
curl -X POST '{SUPABASE_URL}/rest/v1/rpc/get_session_context_by_phone' \
  -H 'apikey: SUA_ANON_KEY' \
  -H 'Authorization: Bearer SUA_SERVICE_KEY' \
  -H 'Content-Type: application/json' \
  -d '{
    "p_phone": "5511999999999",
    "p_owner_phone": "5511888888888"
  }'
```
