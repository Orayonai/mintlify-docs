---
title: 'Validar Leads'
api: 'POST /rest/v1/rpc/get_leads_with_active_window'
description: 'Busca leads com janela de 24h ativa para disparos'
---

## Objetivo

Obter lista de leads que podem receber mensagens (janela 24h do WhatsApp ativa). Essencial para campanhas de disparo em massa.

## Endpoint Principal

```
POST https://tkrjfifrwttikwsghuju.supabase.co/rest/v1/rpc/get_leads_with_active_window
```

## Headers

```bash
apikey: SUA_ANON_KEY
Authorization: Bearer SUA_SERVICE_KEY
Content-Type: application/json
```

## Request Body

<ParamField body="p_hours_window" type="integer" default="24">
  Horas da janela de atividade (padrao: 24)
</ParamField>

<ParamField body="p_confirmed_presence_filter" type="string" default="all">
  Filtrar por confirmacao: `all`, `true`, `false`
</ParamField>

<ParamField body="p_whatsapp_can_reply_filter" type="string" default="all">
  Filtrar por janela: `all`, `true`, `false`
</ParamField>

```json
{
  "p_hours_window": 24,
  "p_confirmed_presence_filter": "true",
  "p_whatsapp_can_reply_filter": "true"
}
```

## Response

```json
[
  {
    "lead_id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "Maria Santos",
    "phone_number": "+5511888888888",
    "email": "maria@email.com",
    "confirmed_presence": true,
    "language": "pt-BR",
    "whatsapp_can_reply": true,
    "window_expires_at": "2026-01-16T18:30:00Z",
    "last_message_at": "2026-01-15T18:30:00Z"
  }
]
```

---

## Funcoes Relacionadas

### get_leads_pending_reminder

Busca leads que precisam receber lembrete:

```json
{
  "p_confirmed_presence_filter": "true",
  "p_reminder_sent_filter": "false",
  "p_max_reminders": 1
}
```

### get_leads_with_window

Busca leads com controle de lembretes:

```json
{
  "p_confirmed_presence_filter": "all",
  "p_reminder_sent_filter": "all",
  "p_max_reminders": 999,
  "p_exclude_reminded_hours": 1
}
```

### validate_leads_chatwoot_batch

Valida leads em lote com dados do Chatwoot:

```json
{
  "p_hours_window": 24,
  "p_limit": 50,
  "p_offset": 0
}
```

---

## Exemplo cURL

```bash
curl -X POST 'https://tkrjfifrwttikwsghuju.supabase.co/rest/v1/rpc/get_leads_with_active_window' \
  -H 'apikey: SUA_ANON_KEY' \
  -H 'Authorization: Bearer SUA_SERVICE_KEY' \
  -H 'Content-Type: application/json' \
  -d '{
    "p_hours_window": 24,
    "p_confirmed_presence_filter": "true",
    "p_whatsapp_can_reply_filter": "true"
  }'
```

## Casos de Uso

| Funcao | Quando Usar |
|--------|-------------|
| `get_leads_with_active_window` | Disparo em massa |
| `get_leads_pending_reminder` | Lembretes automaticos |
| `validate_leads_chatwoot_batch` | Sync com Chatwoot |

<Warning>
  Sempre verifique `whatsapp_can_reply = true` antes de enviar mensagens para evitar bloqueios.
</Warning>
